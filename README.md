## ãƒ‡ãƒ¼ã‚¿åé›†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

åˆæœŸåŒ–(å¤§é‡å–å¾—)ã¨æ—¥æ¬¡/å®šæœŸå·®åˆ†æ›´æ–°ã‚’åˆ†é›¢ã—ã¾ã—ãŸã€‚

### 1. åˆæœŸã‚¹ã‚¯ãƒ¬ã‚¤ãƒ— (æ‰‹å‹•å°‚ç”¨)
åˆå›ã®ã¿ `apps/scraper/scrape_pokefuta.py` ã‚’ä½¿ç”¨ã—ã¦ä¸€æ‹¬å–å¾—ã—ã¾ã™ã€‚ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ŒåˆæœŸåŒ–ã€ä»¥å¤–ã§ã¯ä½¿ã„ã¾ã›ã‚“ (GitHub Actions ã«çµ„ã¿è¾¼ã¾ãªã„ã§ãã ã•ã„)ã€‚

ä¾‹:
```bash
python apps/scraper/scrape_pokefuta.py --scan-max 500 --out apps/scraper/pokefuta.ndjson
git add apps/scraper/pokefuta.ndjson && git commit -m "feat: initial dataset"
```

å…¬é–‹ç”¨ã‚³ãƒ”ãƒ¼:
```bash
cp apps/scraper/pokefuta.ndjson docs/pokefuta.ndjson
git add docs/pokefuta.ndjson && git commit -m "chore: publish initial dataset"
```

### 2. å·®åˆ†ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ (GitHub Actions / æ‰‹å‹•æ¤œè¨¼)
æ—¥æ¬¡ã¯ `.github/workflows/scrape-daily.yml` ãŒ `apps/scraper/update_pokefuta.py` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ä¸»ãªå‡¦ç†:
1. æ–°è¦ãƒãƒ³ãƒ›ãƒ¼ãƒ«æ¤œå‡º (æœªç™»éŒ² ID ã§ãƒšãƒ¼ã‚¸å–å¾—æˆåŠŸ)
2. å‰Šé™¤æ¤œå‡º (ä»¥å‰ active ã ã£ãŸ ID ãŒ 404 ã‚‚ã—ãã¯åº§æ¨™æŠ½å‡ºå¤±æ•—) â†’ status=deleted
3. å¤‰æ›´æ¤œå‡º (ã‚¿ã‚¤ãƒˆãƒ« / lat / lng / pokemons ã®å·®åˆ†)
4. ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ›´æ–°:
	- `first_seen`: åˆå›æ¤œå‡ºæ—¥æ™‚ (UTC ISO8601)
	- `last_seen`: å†…å®¹ãŒå¤‰åŒ–ã—ãŸæ™‚ or å†å–å¾—æˆåŠŸæ™‚ã®æœ€æ–°è¦³æ¸¬æ—¥æ™‚
	- `added_at`: Web UI ç”¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹ (åˆæœŸ = first_seen)
	- `source_last_checked`: ç›´è¿‘ã§ãƒšãƒ¼ã‚¸ã‚’å†å–å¾—ã—ãŸæ—¥æ™‚ (å¤‰æ›´ãªãã¦ã‚‚æ›´æ–°)
	- `status`: active | deleted
5. `apps/scraper/pokefuta.ndjson` ã‚’å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰ (deleted å«ã‚€) ã§æ›´æ–°
6. å…¬é–‹ç”¨ `docs/pokefuta.ndjson` ã¯ active ã®ã¿å‡ºåŠ›
7. å·®åˆ†ã‚’ `CHANGELOG.md` ã«è¿½è¨˜ã—ã€å¤‰æ›´ã‚ã‚Œã°è‡ªå‹• PR ä½œæˆ

ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼ä¾‹:
```bash
python apps/scraper/update_pokefuta.py --scan-max 200 --out apps/scraper/pokefuta.ndjson --copy-to docs/pokefuta.ndjson --log-level DEBUG
git diff --name-only
```

### ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ (NDJSON)
å„è¡Œã® JSON ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¾‹ (active ãƒ¬ã‚³ãƒ¼ãƒ‰):
```json
{
	"id": "123",
	"title": "é¹¿å…å³¶çœŒ/æŒ‡å®¿å¸‚ ãƒã‚±ãµãŸ",
	"title_en": "",
	"title_zh": "",
	"prefecture": "é¹¿å…å³¶çœŒ",
	"city": "æŒ‡å®¿å¸‚",
	"address": "...",
	"city_url": "https://...",
	"lat": 31.12345,
	"lng": 130.54321,
	"pokemons": ["ã‚¤ãƒ¼ãƒ–ã‚¤"],
	"pokemons_en": [],
	"pokemons_zh": [],
	"detail_url": "https://local.pokemon.jp/manhole/desc/123/?is_modal=1",
	"prefecture_site_url": "",
	"first_seen": "2025-10-18T00:00:00Z",
	"last_seen": "2025-10-18T00:05:12Z",
	"added_at": "2025-10-18T00:00:00Z",
	"source_last_checked": "2025-10-18T00:05:12Z",
	"status": "active"
}
```

å‰Šé™¤æ¤œå‡ºå¾Œã¯ `status: deleted` ã¨ãªã‚Šã€`docs/pokefuta.ndjson` ã«ã¯å‡ºåŠ›ã•ã‚Œã¾ã›ã‚“ (å±¥æ­´ã¯ `apps/scraper/pokefuta.ndjson` ã«æ®‹ã‚‹)ã€‚

## GitHub Actions
`.github/workflows/scrape-daily.yml` ãŒæ¯æ—¥å®Ÿè¡Œã•ã‚Œã€å·®åˆ†ãŒã‚ã‚Œã° PR ã‚’ç”Ÿæˆã—ã¾ã™ (æ‰‹å‹•ãƒˆãƒªã‚¬å¯)ã€‚

## ä»Šå¾Œã®æ”¹å–„ã‚¢ã‚¤ãƒ‡ã‚¢
- å¤šè¨€èªãƒã‚±ãƒ¢ãƒ³åã®æ­£è¦åŒ–ãƒãƒƒãƒ”ãƒ³ã‚°
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ / ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥ã®è‡ªå‹•èª¿æ•´ (ã‚µãƒ¼ãƒè² è·è»½æ¸›)
- å¤±æ•— ID ãƒªãƒˆãƒ©ã‚¤ã‚­ãƒ¥ãƒ¼ã®æ°¸ç¶šåŒ–
- å‰Šé™¤æ¸ˆã¿ä¸€è¦§ã®åˆ¥ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåŒ– (`deleted.ndjson`)

# Pokefuta Tracker

è¨ªã‚ŒãŸãƒã‚±ãƒ¢ãƒ³ãƒãƒ³ãƒ›ãƒ¼ãƒ«ï¼ˆãƒã‚±ãµãŸï¼‰ã‚’ç®¡ç†ãƒ»å¯è¦–åŒ–ã™ã‚‹ãŸã‚ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚
åœ°å›³ä¸Šã«ãƒã‚±ãµãŸã‚’è¡¨ç¤ºã—ã€è¨ªå•æ¸ˆã¿ã®ãƒã‚§ãƒƒã‚¯ã€é€²æ—ç®¡ç†ã€CSV/GeoJSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãªã©ãŒå¯èƒ½ã§ã™ã€‚

## ğŸŒ ãƒã‚±ãµãŸãƒãƒƒãƒ—ï¼ˆGitHub Pagesï¼‰

ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒã‚±ãµãŸãƒãƒƒãƒ—ã‚’GitHub Pagesã§å…¬é–‹ã—ã¦ã„ã¾ã™ï¼š

### ãƒšãƒ¼ã‚¸ä¸€è¦§
- **[ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼](https://nishiokya.github.io/pokefuta-tracker/)** - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ã§ãƒã‚±ãµãŸã‚’åœ°å›³ä¸Šã§è¡¨ç¤º
- **[è¿‘ãã®ãƒãƒ³ãƒ›ãƒ¼ãƒ«](https://nishiokya.github.io/pokefuta-tracker/nearby_manholes.html)** - ç¾åœ¨åœ°ã‹ã‚‰è¿‘ã„ãƒã‚±ãµãŸã‚’ãƒªã‚¹ãƒˆè¡¨ç¤º

### æ©Ÿèƒ½
- ğŸ“ æ—¥æœ¬å…¨å›½ã®ãƒã‚±ãµãŸã‚’åœ°å›³ä¸Šã§è¡¨ç¤º
- ğŸ—¾ Leafletãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—
- ğŸ“ å„ãƒã‚±ãµãŸã®è©³ç´°æƒ…å ±ï¼ˆå ´æ‰€ã€ãƒã‚±ãƒ¢ãƒ³ã€å…¬å¼è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ï¼‰
- ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆPCãƒ»ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œï¼‰
- ğŸ“ ä½ç½®æƒ…å ±ã«ã‚ˆã‚‹è·é›¢è¨ˆç®—ã¨è¿‘ã„ãƒãƒ³ãƒ›ãƒ¼ãƒ«ã®è¡¨ç¤º

### ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹
- ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã«ã‚ˆã£ã¦å–å¾—ã—ãŸæœ€æ–°ã®ãƒã‚±ãµãŸæƒ…å ±
- NDJSONå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†
- è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã‚ˆã‚‹å®šæœŸæ›´æ–°

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
apps/
â”œâ”€â”€ web/                      # Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ pokefuta_map.html    # ãƒ¡ã‚¤ãƒ³ã®ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ nearby_manholes.html # è¿‘ãã®ãƒãƒ³ãƒ›ãƒ¼ãƒ«ãƒªã‚¹ãƒˆãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ pokefuta.ndjson      # ãƒã‚±ãµãŸãƒ‡ãƒ¼ã‚¿ï¼ˆNDJSONå½¢å¼ï¼‰
â”œâ”€â”€ scraper/                 # ãƒ‡ãƒ¼ã‚¿åé›†
â”‚   â””â”€â”€ scrape_pokefuta.py   # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
docs/                        # GitHub Pagesç”¨
â”œâ”€â”€ index.html              # å…¬é–‹ç”¨ãƒãƒƒãƒ—ãƒšãƒ¼ã‚¸
â”œâ”€â”€ nearby_manholes.html    # å…¬é–‹ç”¨ãƒªã‚¹ãƒˆãƒšãƒ¼ã‚¸
â””â”€â”€ pokefuta.ndjson         # å…¬é–‹ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
.github/workflows/           # CI/CD
â””â”€â”€ deploy.yml              # GitHub Pagesè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```